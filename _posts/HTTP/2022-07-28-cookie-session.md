---
layout: post
title: "세션이란?"
subtitle: "세션"
comments: true
categories : HTTP
date: 2022-07-28
background: '/img/posts/06.jpg'
---

# 소개
쿠키와 세션을 공부하려고 구글링을 해보시면 거의 비슷한 내용의 글들이 많습니다.
내용 자체도 그렇지만 구성 자체도 그렇습니다.
`HTTP의 특성 - 쿠키설명 - 세션설명 - 쿠키/세션 비교`와 같은 구성입니다.
HTTP의 특성에 따른 단점을 보완하기 위해 필요한 것이 쿠키와 세션이기 때문입니다.
처음엔 굳이 저렇게 설명할 필요가 있을까 라는 생각을 했지만 여러 글들을 읽어 보면서 위와 같은 구성으로 이해하는 것이 좋다는 것을 느끼게 됐습니다.
저 또한 위의 구성으로 글을 작성하도록 하겠습니다.

## HTTP의 특성
- Connetcionless(비연결지향)
- Stateless(비상태성)
위 특성을 요약하면 `요청/응답이 끝나면 끝이다.` 정도로 말할 수 있을 것 같습니다.
클라이언트, 서버는 연결되어 있지 않기 때문에 서로를 모르는 상태가 되는 것입니다.
이것은 리소스를 절약할 수 있는 장점이 있지만 서로를 알수가 없기 때문에 인증과 같은 기능이 필요할 때는 단점이 됩니다.
이런 단점을 해결하기 위해 쿠키와 세션이 존재 합니다.

## 쿠키?
쿠키는 클라이언트 로컬에 저장되는 Key, Value를 가지는 데이터 입니다.
쿠키의 제어 자체는 클라이언트/서버 둘 다 가능합니다.(HttpOnly 옵션을 이용하여 클라이언트에서는 불가능하게 할 수도 있습니다.)
브라우저별로 저장하기 때문에 공유 되지 않습니다.(요즘엔 크롬과 엣지처럼 공유할 수 있는 브라우저들도 등장했습니다.)

### 쿠키의 구성요소
- 쿠키이름
- 쿠키 값
- 만료시간
- 전송할 도메인명
- 전송할 경로
- secure(보안연결여부)
- HttpOnly

### 동작 방식
![쿠키 동작 방식](https://miro.medium.com/max/1400/1*fWfKsO9P2rReNzJM2doBhQ.png){: width="723"}
위 그림은 로그인을 예시로 합니다. 이는 예시일 뿐 일반적인 쿠키의 사용방법으로 이해 하시면 됩니다.
1. 클라이언트가 서버에 로그인 요청을 합니다.
2. 서버는 클라이언트의 로그인 요청의 유효성을 확인하고(로그인 예시 에서는 아이디, 비밀번호를 확인하겠지만 개발자가 원하는 다른 어떤 것도 가능합니다.) 응답헤더에 쿠키를 추가합니다.
3. 클라이언트는 이후 서버에 요청을 할 때마다 최초 응답 시 받은 쿠키를 응답헤더에 추가하여 요청합니다. 이는 브라우저가 자동으로 처리하며, 원한다면 개발자가 제어 할 수 있습니다.
예시에서는 클라이언트가 요청을 했을 때 서버에서 쿠키를 주는 것으로 했지만 클라이언트에서 쿠키를 제어할 수도 있습니다.
쿠키는 보안을 위한 최소한의 장치(Secure, HttpOnly)가 있기는 하지만 기본적으로 클라이언트와 서버가 데이터를 공유하는 것을 목적으로 합니다.

### 쿠키확인
크롬을 기준으로 EditCookie와 같은 플러그인을 사용하셔도 되지만 개인적으로 개발자도구로 충분하다는 생각이 듭니다.
개발자 도구 > Application 탭 > Storage > Cookies로 이동하시면 현재 내가 접속한 사이트의 쿠키를 확인하실 수 있습니다.
어떤 쿠키들이 있고 어떻게 사용되는지 공부해보시면 쿠키를 이해하는데 많은 도움이 될 것 같습니다.

## 세션?
쿠키와 유사하지만 서버에 저장하고 서버만 제어가 가능합니다.
클라이언트는 세션 값을 받아서(실제로는 쿠키로 받게 됩니다.) 요청 할 때 서버로 함께 보내줍니다.
<br>
![세션 방식](https://miro.medium.com/max/1400/1*oiHghHg3sQW5ynmMCAtPAA.png){: width="723"}
1. 쿠키의 1번 방식과 동일합니다.
2. 쿠키의 2번 방식과 동일합니다.
3. 쿠키의 3번 방식과 동일합니다.
4. 서버에 저장된 세션의 정보와 클라이언트가 보내준 세션의 정보가 일치하는지 확인 후 요청을 처리하고 응답합니다.
거의 모든 과정이 똑같으면 뭐가 다른거지? 라는 의문이 드실 수 있을 것 같습니다.
기본적으로 세션은 쿠키와 아주 유사합니다.
세션도 결국엔 쿠키를 이용하기 때문입니다.
세션이 쿠키와 다른 차이점은 서버에서 해당 데이터를 가지고 있다는 점입니다.

## 쿠키와 세션의 차이점
1. 저장위치 : 쿠키는 로컬에만 존재하고 세션은 로컬과 서버에 저장합니다.
2. 보안 : 쿠키는 모든 데이터를 열람할 수 있는 상태로 주고 받는 반면에 세션은 ID 값 만을 주고 받기 때문에 상대적으로 안전합니다. 하지만 분명한 한계점이 있습니다.
3. Lifecylcle : 쿠키는 브라우저를 종료해도 파일로 남지만, 세션은 브라우저 종료시 세션을 삭제합니다. 로컬에 데이터를 저장하는 쿠키와 서버에 데이터를 저장하는 세션의 차이입니다.
4. 속도 : 쿠키가 상대적으로 빠를 수 있습니다. 로컬의 파일을 읽기 때문입니다. 하지만 크게 유의미한 차이를 낸다고 보기는 어렵습니다. 다만 그럴 수 있다는 얘기 입니다.


## 쿠키/세션의 보안 취약점
세션은 쿠키에 비해 보안상 유리 하지만 근본적으로 공유하는 취약점이 있습니다. 
[이 영상](https://m.youtube.com/watch?v=MyB7gj0fJdw){:target="_blank"}에서 그 한계점을 명확히 확인 할 수 있습니다.
위 동영상은 실제로 서비스되는 네이버에서 쿠키를 탈취해 해킹을 하는 과정을 예시로 보여줍니다.
네이버 처럼 큰 시스템은 보안에 안전하겠지? 라는 생각을 하실 수 있지만 결국 세션만 이용한다면 보안상의 취약점은 해결 할 수 없습니다.
이렇게 쿠키/세션은 보안과 관련된 명확한 한계를 가지고 있습니다.
이런 단점을 보안하기 위해 여러가지 방법을 시도 할 수 있습니다.
이 글은 쿠키와 세션이 뭔지 정리 하기 위한 글이기 때문에 따로 정리하지는 않겠습니다.
궁금하신 분들은 [여기](https://swk3169.tistory.com/m/22){:target="_blank"}를 참고 하시면 도움이 될 것 같습니다.

## 마무리
쿠키와 세션에 대한 글을 작성했지만 아직도 할 얘기가 많이 남아있습니다.
개념을 기반으로 하여 실제 시스템을 뜯어 보면서 스텝업 하셨으면 좋겠습니다.


## 참고
- [세션(Session)이란 무엇일까?](https://crossjin.tistory.com/entry/%EC%84%B8%EC%85%98Session%EC%9D%B4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%BC%EA%B9%8C){:target="_blank"}
- [쿠키, 세션이란?](https://chrisjune-13837.medium.com/web-%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98%EC%9D%B4%EB%9E%80-aa6bcb327582){:target="_blank"}
- [세션 하이재킹, 세션을 이용한 개인정보 해킹과 세션 보안의 중요성](https://swk3169.tistory.com/m/22){:target="_blank"}

--- 

{% highlight ruby linenos %}
{% endhighlight %}

{% if page.comments %}
<div id="post-disqus" class="container">
{% include disqus.html %}
</div>
{% endif %}
