---
layout: post
title: "비녀의 Package Manager(10분 테코톡)"
subtitle: ""
comments: true
categories : Node
date: 2022-09-19
background: '/img/posts/06.jpg'
---

# 소개
우아한형제들의 유투브 채널인 `우아한Tech`에 올라온 Package Manager에 관한 영상을 바탕으로 글을 작성합니다.
15:42초의 영상입니다.
목차는 아래와 같습니다.
```
1. JS의 모듈 import
1. Package Manager란?
2. Npm & Yarn
3. Pnpm & Yarn berry
4. 실제 사례
5. 결론
```

## 1. JS의 모듈 import
자바스크립트에서 `import`키워드는 지원된지 얼마 되지 않았습니다.
`모듈`이라는 개념은 `import` 이전에 존재하긴 했지만, 마찬가지로 얼마 되지 않았습니다.
이런 개념과 키워드는 자바스크립트의 역할이 커짐에 따라 필요해졌습니다.
이제는 수많은 모듈들이 생겨났고, 이것들을 효과적으로 다룰 필요가 생겼습니다.

## 2. Package 란?
위에서 본 모듈을 뭉쳐놓은 덩어리 하나를 말합니다.
Node.js에서는 require를 통해 가져올 수 있는 모듈로 정의하고 있습니다.
또는 package.json 파일을 가지고 있는 모듈 혹은 모듈의 뭉치를 package로 정의하기도 합니다.

## 3. NPM의 등장( Node Package Manager )
package들이 등장 하면서 이를 효과적으로 관리할 수 있는 도구가 필요해졌습니다.
그래서 나온 것이 npm입니다.
npm은 다음과 같은 목적을 가지고 만들어졌습니다.
1. 여러 버전의 통일한 패키지를 한 프로젝트에서 사용할 수 있게 합니다.
2. 설치 방식을 통일합니다.
3. 패키지 관련 정보가 들어 있는 메타 데이터를 간소화 합니다.
4. 누구나 배포할 수 있도록 합니다.

## 4. Yarn의 등장( yet another resource negotiator )
기본적으로 동일한 목적을 가지지만, npm에서 개선된 성능을 제공하고자 등장했습니다.
1. 병렬화를 통한 속도 개선
2. 자동화 된 lock 생성
  - 현재는 npm도 lock 파일을 제공하지만 원래는 제공하지 않았습니다.
3. 의존성 트리 알고리즘 변경
4. 캐시 사용
  - 캐시된 별도의 파일을 관리하여 이미 다운받은 패키지를 다운 받지 않도록 합니다.

## 5. NPM 계열의 한계
1. 비효율적 의존성 검색
  - 직접 디렉토리를 검사해서 의존성을 추가 합니다.
  - 의존성이 없다면 모든 디렉토리를 전부 검색한 후에 패키지를 추가하게 될 수도 있습니다.
  - 만약 중간에 잘못된 의존성이 있더라도 그대로 가져와 사용하게 될 수 있습니다.
2. 유령 의존성(호이스팅)
  - package.json에 명시되지 않은 의존성이 프로젝트에 추가될 수 있는 것을 의미합니다.
  - 대표적인 첫번째 문제는 다른 버전을 가지 동일한 의존성이 추가되는 것입니다.
  - 두번째 문제는 특정 패키지(A)를 삭제할 때 종속적인 다른 패키지(B)가 삭제되면서 종속적인 다른 패키지(B)를 사용하는 다른 패키지(C)에서 에러가 발생할 수 있습니다.
3. 너무 무거운 node_modules

## 5. Pnpm
npm, yarn의 한계를 극복하기 위해 등장했습니다.
기본적인 개념은 가져가되 평탄화되지 않은 node_modules를 사용합니다.
평탄화된 npm의 node_modules가 아니라 훨씬 복잡한 구조를 가지고 있고, 이를 제대로 사용하기 위한 알고리즘을 가지고 있습니다.
프로젝트 별로 모든 패키지를 전부 다운로드 받는 기존의 방식이 아니라 루트 디렉토리에 한 번만 패키지를 다운로드 받습니다.
그리고 실제 사용을 하는 곳에서는 루트 디렉토리에서 특정 패키지를 가져다 쓸 수 있는 Symbolic Link만을 가지고 있습니다.

## 6. Yarn berry
npm, yarn의 한계를 극복하려 한 것은 맞지만 node_modules라는 개념자체를 없애 버리려는 의도를 가지고 있습니다.
`node_modules와 Node에 내장된 의존성 관리 없이 의존성을 관리하면 어떨까?`라는 생각을 가지고 있습니다.
node_modules 폴더 자체를 없애고 캐시된 zip 파일을 가집니다.
이는 3가지 정도의 장점을 가집니다.
1. Zero Install(Yarn install이 불필요합니다.)
2. 오프라인에 캐싱기능으로 사용가능 합니다.
3. ci 배포시에 clone만 하면 의존성이 다 있기 때문에 배포 속도를 줄일 수 있습니다.

몇 가지의 장점을 가지고 있지만 하나 궁금한 점이 생깁니다.
node_modules 라는 의존성들이 모여있는 폴더가 없다면 어떻게 복잡한 의존성이 관리되는 것일까요?

### 6-1. Yarn berry - Plug'n'Play
코드만 꼽으면 바로 실행할 수 있다는 의미 입니다.
yarn berry Pnpm과 마찬가지로 매핑을 위한 파일을 제공합니다.
바로 `pnp.cjs`라는 파일입니다.
이것은 어떤 패키지인지, 어떤 버전인지, 어느 위치에 있는지, 어떤 의존성을 참조 하는지와 같은 정보들을 포함합니다.

## 7. 뭐가 제일 좋을까?
영상을 준비하신 비녀님은 동일한 프로젝트에 대해 다른 패키지 매니저를 사용해서 결과를 정리해주셨습니다.
1.npm
  - size : 109 MB
  - File : 10321개
2.yarn
  - size : 107 MB
  - File : 9934개
3.Pnpm
  - size : 80.7 MB
  - File : 10487개
4.yarn berry
  - size : 42.2 MB
  - File : 734개

위 결과만 보면 뮤조건 yarn berry가 무조건 좋아보이지만 그렇지만은 않습니다.
용도에 맞게 사용하는 것이 중요합니다.

---
## 참고
- [비녀의 Package Manager](https://m.youtube.com/watch?v=Ds7EjE8Rhjs){: target="_blank"}


{% if page.comments %}
<div id="post-disqus" class="container">
{% include disqus.html %}
</div>
{% endif %}
