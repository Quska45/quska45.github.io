---
layout: post
title: "TDD 개념 정리"
subtitle: ""
comments: true
categories : ETC
date: 2022-07-25
background: '/img/posts/06.jpg'
---

# 소개
최근 회사 프로젝트에 테스트 코드를 도입하면서 TDD도 함께 적용을 해야 겠다는 목표를 세웠습니다.
TDD에 대한 개념적인 내용을 구글링 하는 중에 [망나니 개발자](https://mangkyu.tistory.com/182){:target="_blank"}님의 글을 보면서 많은 도움이 됐습니다.
이 글은 망나니 개발자님의 포스팅을 기반으로 해서 제 개인적인 공부를 위해 작성되었음을 알려 드립니다.
단위 테스트의 중요성과 단위 테스트를 바탕으로 하는 TDD는 어떻게 하는 것인지 이론적인 소개에 대한 내용입니다.

## 1. 단위 테스트의 중요성과 좋은 단위 테스트의 특징
### 단위 테스트를 작성해야 하는 이유
- 코드를 수정하거나 기능을 추가할 때 수시로 빠르게 검증 할 수 있습니다.
- 리팩토링 시에 안정성을 확보할 수 있습니다.
- 개발 및 테스팅에 대한 시간과 비용을 절감할 수 있습니다.

평소 개발을 완료하고 문제가 없는지 확인하기 위해 어플리케이션을 실행하고 직접 수동으로 통합 테스트를 진행합니다.
이는 테스트를 위해 지나치게 많은 비용을 지불하는 일이 될 수 있습니다.
통합 테스트를 위해서는 캐시, 데이터베이스 등 외부 컴포넌트들과 연결 등 부가적이 시간이 필요하기 때문입니다.
또 버그 발생 시에 어디서 어떤 버그가 몇 개나 발생했는지도 알기 어렵습니다.
이런 문제들이 있기 때문에 단위 테스트를 작성하게 됩니다.

### 좋은 테스트의 특징
1. Fast : 테스트는 빠르게 동작하여 자주 돌릴 수 있어야 합니다.
2. Independent : 각각의 테스트는 독립적이며 서로 의존해서는 안됩니다.
3. Repeatable : 어느 환경에서도 반복 가능해야 합니다.
4. Self-Validating : 테스트는 성공 또는 실패를 bool 값으로 결과를 내어 자제적으로 검증 되어야 합니다.
5. Timely : 테스트는 적시에 해야 합니다. 즉, 테스트 하려는 실제 코드를 구현하기 직전에 구현해야 합니다.
위의 내용을 이해했다면 테스트를 하는 비용이 실제 개발보다 크다면 테스트 코드는 작성하지 않는 것이 바람직합니다.
테스트 만을 위한 테스트 코드는 경계할 필요가 있습니다.
다음 내용은 왜 테스트 코드를 먼저 작성해야 하고 어떻게 테스트 코드를 먼저 작성할 수 있는지에 대해 알아보겠습니다.

## 2. TDD, 테스트 코드를 먼저 작성해야 하는 이유와 방법 및 순서
### 테스트 코드를 먼저 작성해야 하는 이유
- 깔끔한 코드를 작성할 수 있습니다.
- 장기적으로 개발 비용을 절감할 수 있습니다.
- 개발이 끝나면 테스트 코드를 작성하는 것은 매우 귀찮고 힘든 일입니다.
TDD의 궁극적인 목표는 작동하는 깔끔한 코드를 작성하는 것 입니다. TDD의 개발 단계에는 리팩토링이 있는데, 이 리팩토링 과정을 거치면서 중복된 코드들은 제거되고, 복잡한 코드들은 깔끔하게 정리됩니다.
테스트를 처음 작성할 때에는 귀찮고 개발이 느려진다는 느낌을 받을 수 있지만 장기적으로 보면 반드시 개발 비용을 아껴줄 것 입니다.
마지막으로 개발을 완료한 후에 테스트 코드를 작성하는 것은 너무 귀찮은 일이 됩니다.
성공 케이스 뿐만 아니라 실패한 케이스도 코드를 작성해야 하고 이미 개발이 완료 되었다는 심리적인 요인도 작용하기 때문입니다.
추가적으로 테스트 코드를 작성할 때 생각하셔야 하는 것은 실패 테스트를 먼저 작성해야 한다는 것입니다.
순차적으로 실해하는 테스트를 먼저 작성하고, 오직 테스트가 실패할 경우에만 새로운 코드를 작성해야 합니다.
그리고 중복된 코드가 있다면 제거해 나가야 합니다.

### TDD 방법 및 순서
1. 실패하는 작은 단위 테스트를 작성합니다. 처음에는 컴파일 조차 되지 않을 수 있습니다.
2. 빨리 테스트를 통과하기 위해 프로덕션 코드를 작성합니다. 이를 위해 정답이 아닌 가짜 구현 등을 작성할 수도 있습니다.
3. 그 다음의 테스트 코드를 작성합니다. 실패 테스트가 없을 경우에만 성공 테스트를 작성합니다.
4. 새로운 테스트를 통과하기 위해 프로덕션 코드를 추가 또는 수정합니다.
5. 1~4 단계를 반복하여 실패/성공의 모든 테스트 케이스를 작성합니다.
6. 개발된 코드들에 대해 모든 중복을 제거하며 리팩토링 합니다.

위의 과정을 따라 개발을 진행하면 자연스럽게 프로덕션 코드보다 테스트 코드를 먼저 작성하게 될 것 입니다.
물론 이것을 이론적으로만 이해하기는 어렵습니다.
또 이런 규칙을 Sping, Vue와 같은 프레임워크에 적용하는 것은 다른 영역입니다. 이런 이유로 ATDD(Application TDD)라고 불리기도 합니다.

## TDD 접근 방법
- 가짜로 구현하기 : 최대한 빨리 테스트를 통과하기 위해 정답이 아닌 가짜 정답을 구현하는 방법입니다.
- 감각측량법 : 값이 다른 여러 테스트를 작성하고, 이를 일반화하여 정답을 구현하는 방법입니다.
- 명백하게 구현하기 : 정답을 바로 구현하는 방법

### 가짜로 구현하기
실패하는 테스트를 가장 빠르게 구현하는 방법은 아무 값이나 반환하도록 하는 것입니다.
그리고 테스트가 통과하면 단계적으로 상수를 변수를 사용하도록 변형합니다.
예를 들어 다음과 같은 곱하기 테스트를 작성했다고 해보겠습니다.

```java
@Test
public void 곱하기테스트() {
    // given
    
    // when
    final int result = multiply(2, 3);
    
    // then
    assertThat(result).isEqualTo(6);
}
```
<br>
위의 테스트를 가장 빨리 통과하는 방법은 곱하기 함수가 6을 리턴하는 것입니다.
<br>
```java
public int multiply( int num1, int num2 ){
  return 6;
}
```
위와 같이 변수를 사용하지 않고 상수를 반환하는 것으로 `가짜 구현`한 것 처럼 최대한 빨리 테스트를 통과하는 것이 가짜 구현 방법입니다.
이런 연습을 많이 하면 복잡한 코드를 잘게 쪼게서 복잡한 코드를 구성해나가는 능력을 기를 수 있습니다.
빠르게 개발하고 오류없이 개발되고 발전해나가는 코드를 통해 개발이 잘 진행되고 있음을 확인 할 수 있습니다.
또 구체적인 코드를 일반화해 나가면서 불필요한 고민과 혼동을 줄 일 수 있습니다.

### 삼각 측량
삼각 측량은 테스트 주도로 추상화된 과정을 일반화하는 과정입니다. 
삼각 측량 방법은 테스트 예시가 2개 일 때에만 추상화를 해야 합니다.
```java

@Test
public void 곱하기테스트() {
    // given
    
    // when
    final int result1 = multiply(2, 3);
    final int result2 = multiply(4, 7);
    
    // then
    assertThat(result1).isEqualTo(6);
    assertThat(result2).isEqualTo(28);
}
```

### 명백하게 구현하기
명백하게 구현하는 방법은 가짜 구현이나 삼각 측량 방법을 사용하지 않고 바로 정답을 구현하는 방법입니다.
현재 사용하고 있는 곱하기와 같은 간단한 기능 다음과 같이 바로 진짜 구현을 하는 것이 좋은 방법이 될 수 있습니다.
```java
public int multiply(final int num1, final int num2) {
    return num1 * num2;
}
```

## 마무리
글 내용 중에 언급 되었듯이 TDD의 궁극적인 목표는 작동하는 깔끔한 코드를 작성하는 것 입니다.
코드를 작은 단위부터 빠르게 개발/테스트 하면서 안정성을 높이고 유지,보수가 쉬운 코드를 작성해 나갈 수 있는 것이 TDD의 장점인 것 같습니다.
이 글을 통해 TDD가 얼마나 좋은지 확신을 가지게 되기는 어렵습니다.
개념적인 내용을 바탕으로 실제 개발에 적용해봐야만 비로소 느껴지시는 부분들이 있을 것 입니다.
TDD를 한 번쯤은 꼭 적용해 보시고 내 코드의 수준이 얼마나 올라 가는지 체험해 보셨으면 좋겠습니다.

---
## 참고
- [단위 테스트와 TDD(테스트 주도 개발) 프로그래밍 방법 소개 - (1/5)]([https://mangkyu.tistory.com/15](https://mangkyu.tistory.com/182))

{% if page.comments %}
<div id="post-disqus" class="container">
{% include disqus.html %}
</div>
{% endif %}
