---
layout: post
title: "쿼리치의 Process vs Thread(10분 테코톡)"
subtitle: ""
comments: true
categories : ETC
date: 2022-08-09
background: '/img/posts/06.jpg'
---

# 소개
우아한형제들의 유투브 채널인 `우아한Tech`에 올라온 Process와 Thread에 관한 영상을 바탕으로 글을 작성합니다.
9:59초의 영상입니다.
목차는 아래와 같습니다.
```
1. 멀티 프로세스
2. 멀티 스레드
3. 멀티 코어
4. 요약
```

## 개요
- 프로세스
- 프로세서
- 프로그램
- 스레드
- 코어
- 동시성
- 병렬성

프로세스와 스레드에 대해서 공부하다보면 위와 같은 단어들을 접하게 됩니다.
익숙치 않아 어렵기도 하고 정말 헷갈리는 부분도 많습니다.
그래서 일단은 `프로세스`와 `스레드`만 정리하고 얘기를 이어 나가 보겠습니다.
- 프로세스 : 자원할당의 단위
- 스레드 : 작업의 단위

## 프로세스
프로세서에 의해 실행되는 프로그램을 말합니다.
프로세스, 프로세서, 프로그램은 이름에서 알 수 있듯이 밀접한 관련이 있습니다.
예를 들어 개발자들이 코드를 작성해서 만들어내는 것은 `프로그램`입니다.
이 프로그램이 실제로 실행되기 위해서는 `프로세스`가 되어야 합니다.
이 때 프로그램을 프로세스로 만들어 주는 것이 `프로세서`입니다.
다시 정리하면 `프로세서는 프로그램으로 프로세스를 만든다.`와 같습니다.

### 프로세스가 되기 까지의 과정
1. 개발자가 코드를 작성합니다. `프로그램을 만들어 준다`라고도 할 수 있습니다.
2. 만들어진 프로그램이 시스템 메모리(RAM을 의미합니다.)에 올라갑니다. 이때 프로그램은 `숫자3을 더한다.`와 같은 명령어들의 집합으로 이루어져 있습니다. 이 명령어들은 2진수로 되어 있습니다.
3. 이 명령어들은 실행을 위해 프로세서, 즉 CPU로 이동합니다. 이때 파이프라인이라고 불리는 큐에 쌓이고 프로세서는 이를 순서대로 실행합니다.
4. 위의 과정을 거쳐서 실제로 실행이 일어난다면 서비스가 동작하게 되는 것이고 이것을 `실행중인 프로세스를 만들었다`라고 할 수 있습니다.

### 멀티 태스킹
CPU는 한 번에 하나의 프로세스만 실행한 다는 얘기를 들어 보셨을 것 같습니다.
그럼 우리가 사용하는 컴퓨터는 어떻게 여러개의 프로세스를 실행 시킬까요?(크롬, 게임, 카톡 등 여러개가 동시에 실행되는 것을 말합니다.)
사실 CPU는 여러개의 프로세스를 번갈아서 실행합니다.
이를 매우 작은 단위로 빠르게 수행하기 때문에 저희 입장에서는 마치 동시에 실행되는 것 처럼 느껴지게 됩니다.
이렇게 여러개의 프로세스를 번갈아 가면서 수행하는 것은 `Context Switching` 이라고 합니다.
이런 식으로 여러개의 작업을 번갈아가며 수행해서 마치 여러개의 프로세스가 실행되는 것 처럼 보이게 하는 것을 `멀티 태스킹` 이라고 합니다.
이 경우에 CPU는 다음 작업이 무엇이고 어디서 수행해야 하는지와 같은 정보들을 알아야 합니다.
이는 Process Control Block에 저장 됩니다.

### Process Control Block
Process Control Block은 다음과 같이 구성됩니다. 간단한 설명도 함께 드리겠습니다.
1. Pointer : 프로세스의 현재 위치를 저장하는 포인터 정보
2. Process State : 프로세스의 상태(생성, 준비, 실행, 대기, 종료)
3. Process Number(PID) : 프로세스의 고유 번호
4. Program Counter : 프로세스의 다음 명령어의 주소를 포함하는 카운터 저장
5. Registers
6. Memory Limits
7. Open File Lists
8. 그 외 구성요소들도 있지만 여기서 다루지는 않도록 하겠습니다.

### 프로세스 구조
프로세스는 아래 4가지 요소들로 이뤄져 있습니다.
1. Code :  컴파일된 소스코드가 저장되는 영역
2. Data : 전역 변수, static 변수가 저장되는 영역
3. Heap : 동적으로 생성되는 데이터가 저장되는 영역
4. Stack : 호출된 함수 혹은 지역 변수가 저장되는 영역

### 멀티 프로세스의 단점
멀티 프로세스의 단점은 한 작업을 여러 프로세스가 나눠서 할 때 발생합니다. 다음과 같은 상황입니다.
1. A, B 프로세스가 있다고 가정하겠습니다. 하나의 작업을 나눠서 하는 프로세스기 때문에 같은 Code, Data, Heap을 가집니다.
2. A가 작업을 위해 Code, Data, Heap을 메모리에 올리고 작업을 진행합니다.
3. A의 작업이 끝나면 B의 Code, Data, Heap을 메모리에 올리고 작업을 진행합니다.

이렇게 작업을 할 경우 같은 작업을 하고 있음에도 불구하고 매번 Code, Data, Heap을 메모리에 올렸다가 내리는 불합리가 발생합니다.
추가적으로 A, B 프로세스가 공유해야할 데이터가 생기게 되면 IPC 통신까지 추가로 필요하게 됩니다.
불합리한 낭비가 또 생기게 되는 것입니다.

## 멀티 스레드
위와 같이 여러개의 프로세스를 사용할 때 발생되는 불합리를 개선할 수 있는 것이 멀티 스레드 입니다.
멀티 스레드에 대해 알아보기 전에 스레드의 관점에서 프로세스를 생각해보도록 하겠습니다.

### 스레드 관점에서 보는 프로세스
개요에서 얘기한 것 처럼 프로세스는 자원의 할당 단위이고 스레드는 작업의 단위라는 얘기를 드렸습니다.
이 말은 실제로 작업을 하는 주체는 스레드 라는 의미입니다.
따라서 제가 제시드린 프로세스에 대한 내용은 `단일 스레드 프로세스`입니다.
프로세스의 자원(Code, Data, Heap)이 메모리에 할당 되면 CPU는 스레드를 통해 작업을 수행하는 것입니다.
그럼 이제 진짜 멀티 스레드에 대해서 알아보겠습니다.

### 프로세스에서 멀티 스레드의 구성
하나의 프로세스에서 여러개의 스레드를 만들어주는 멀티 스레드는 개념적으로 크게 어려울 것이 없습니다.
동일한 프로세스 안에서 여러개의 스레드를 만들고 자원을 공유할 수 있도록 해주면 끝입니다.
여러개의 스레드는 프로세스의 자원을 공유할 수 있고 멀티 프로세스의 문제점을 효과적으로 개선 합니다.
동일한 작업을 여러개의 스레드를 사용해 효과적으로 처리할 수 있게 됩니다.
이때 스레드를 구분할 수 있도록 Register Block이 존재하고 프로세서는 이것을 통해 스레드를 구분합니다.

### 멀티 스레드의 단점
위 설명만 보면 멀티 스레드는 멀티 프로세스에 비해 월등히 좋아 보입니다.
하지만 멀티 스레드도 치명적인 단점이 존재하는데 바로 `데드락`입니다.
`데드락`은 다수의 스레드가 동시에 같은 자원에 접근할 때 발생합니다.
이는 에러를 유발하고 프로세스를 종료 시키게 됩니다.
이런 상황을 방지하기 위해서는 동기화를 위한 처리가 필수적으로 필요합니다.
또 한 프로세스 내에서 여러개의 스레드가 동작하기 때문에 하나의 스레드에서 발생한 문제는 전체 프로세스에 영향을 줄 수도 있습니다.

## 멀티 코어
멀티 코어는 프로세스와 스레드에 비해 물리적인 개념입니다.
코어라는 것은 CPU에서 작업을 수행하는 주체이기 때문입니다.
파이프라인에 들어오는 명령어 들을 수행해주는 물리적 장비이기 때문입니다.
CPU가 발열등의 물리적인 이유로 동시성 처리의 발전이 더뎌지면서 대안으로 코어를 늘려서 작업을 수행합니다.
기존에 프로세스들을 번갈아 가면서 수행하거나 한 프로세스에서 스레드를 나눠 동시에 작업을 처리하는 것 처럼 병렬 작업을 흉내내는 것이 아니라 물리적으로 병렬 처리를 하는 것입니다.

### 병렬 처리의 종류
1. 하이퍼 스레딩
  - 코어 하나에 파이프라인을 두개로 쪼개어 한 코어 내부에서 병렬적으로 명령들을 수행하는 방법입니다.
  - 이는 같은 프로세서를 사용한다는 의미 입니다.
  - 하나의 프로세스의 성능을 극한으로 이용할 수 있게 되는 방식입니다.

2. 멀티 코어
  - 파이프라인마다 독립적인 프로세서가 존재합니다.
  - 물리적으로 여러개의 코어를 가지게 됩니다.
  - 멀티코어 라는 단어를 가장 잘 나타낼 수 있는 병렬 처리 방법이네요.

3. 멀티 CPU
  - 말 그대로 여러개의 CPU를 이용해 병렬처리 합니다.
  - CPU가 여러개 필요하기 때문에 가장 비싸지만 가장 좋은 성능을 낼 수 있습니다.

## 요약
1. 프로세스
  - 자원 할당의 단위 입니다.
  - 각 프로세스는 독립적 입니다.
  - 따라서 통신 및 Context Switching 시에 비용이 크다는 단점이 있습니다.

2. 스레드
  - 작업의 단위 입니다.
  - 하나의 프로세스 안에 여러개의 스레드가 존재할 수 있어 자원을 공유합니다.
  - 따라서 통신 및 Context Switching 시에 비용을 줄일 수 있습니다.
  - 하지만 여러개의 스레드가 같은 자원을 공유하거나, 한 스레드가 전체 프로세스에 영향을 주지 않도록 신경 써야 합니다.

3. 코어
  - 스레드의 작업을 수행하는 프로세서 입니다.
  - 여러 작업을 번갈아 가면서 동시에 처리합니다.
  - 물리적으로 여러개의 코어가 존재 할 수 있다면 작업을 번갈아가면서 처리하는게 아니라 병렬로 처리 할 수 있습니다.

## 마무리
해당 영상에 `이걸로 면접 준비 끝`이라는 댓글이 있었는데 저도 딱 그런 느낌입니다.
프로세스와 스레드에 대한 내용이 정말 잘 정리되어 있고 관련된 개념들도 알기 쉽게 정리 되어있었습니다.
좋은 영상 올려주신 쿼리치 님에게 감사드리고,
이 글을 보시는 분들이 프로세스에 대한 개념을 잘 정리 하셨으면 좋겠습니다.

---
## 참고
- [쿼리치의 Process vs Thread](){: target="_blank"}


{% if page.comments %}
<div id="post-disqus" class="container">
{% include disqus.html %}
</div>
{% endif %}
