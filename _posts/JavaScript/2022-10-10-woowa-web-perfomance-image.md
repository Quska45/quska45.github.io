---
layout: post
title: "웹 성능 개선하기(10분 테코톡)"
subtitle: ""
comments: true
categories : Node
date: 2022-10-10
background: '/img/posts/06.jpg'
---

# 소개
우아한형제들의 유투브 채널인 `우아한Tech`에 올라온 웹 성능 개선하기-이미지에 관한 영상을 바탕으로 글을 작성합니다.
13:24초의 영상입니다.
목차는 아래와 같습니다.
```
1. 차세대 이미지 형식 결정하기
2. 적절한 크기의 이미지 사용하기
3. CLS(누적 레이아웃 변경) 개선하기
4. 이미지 Lazy Loading
5. 이미지 Pre Loading
```

## 1. 차세대 이미지 형식 결정하기
1. PNG - 무손실 압축 사용합니다. 최고 품질 이미지를 제공하지만 다른 형식에 비해 크기가 훨씬 큽니다.
2. JPEG - 손실 압축을 사용하여, PNG에 비해 용량이 작습니다.
3. WebP - 구글에서 2010년 발표 했습니다. JPEG보다 더 나은 압축과 더 많은 기능을 제공하는 형식입니다.
4. AVIF - AOMedia에서 2019년 발표했습니다. WebP와 유사하게 높은 압축률을 자랑합니다.

영상에서는 위 4가지 중 WebP를 선택했습니다. 이유는 동영상을 지원하기 위해서는 WebP가 더 적합하기 때문입니다.
동일한 이미지에 대한 JPG 형식과 WebP 형식의 이미지 파일은 대략 35%의 크기 차이가 발생한다고 합니다.
만약 WebP 변환 시에 이미지의 품질을 낮추면 대략 65%의 크기를 줄일 수 있습니다.

### 1-1. WebP 지원 브라우저
모든 브라우저가 WebP를 지원하는 것은 아닙니다.
만약 브라우저에 따라 개발자가 어떤 형식의 이미지를 로드 할지 매번 처리해줘야 한다면 이는 매우 귀찮은 일입니다.
하지만 우리는 `picture`태그와 `source`태그로 이를 처리 할 수 있습니다.

```html
<picture>
    <source srcSet="/assets/coach/cat.webp" type="image/webp" />
    <source srcSet="/assets/coach/cat.jpg" type="image/jpg" />
    <img srcSet="/assets/coach/cat.jpg" alt="코치 고양이" />
</picture>
```
위 코드를 통해 최초에는 webp를 파일에 대한 로드를 시도하지만 만약 실패야하면 jpg를 로드하게 됩니다.

## 2. 적절한 크기의 이미지 사용하기
크기가 854 x 1280 px인 이미지가 있다고 가정 하겠습니다.
이 이미지가 실제로 화면에 렌더링 될 때는 108 x 108의 크기라는 가정도 해보겠습니다.
실제 이미지와 렌더링 되는 크기는 거의 100배가 차이 납니다.
이는 매우 비효율적 입니다.
따라서 우리는 이것을 개선해야할 필요가 있습니다.

### 2-1. 이미지 슬라이스
우선 이것을 가능하게 하는 코드에 대해서 보겠습니다.

```javascript
<img
  srset="
    elva-fairy-320w.jpg 320w,
    elva-fairy-480w.jpg 480w,
    elva-fairy-800w.jpg 800w
  "
  sizes="
    (max-width: 320px) 280px,
    (max-width: 480px) 440px,
    800px
  "
  src="elva-fairy-800w.jpg" alt="요정 옷을 입은 엘바"
>
```

- srset : 브라우저에게 제시할 이미지 목록과 그 크기를 정의합니다.
- sizes : 화면 크기에 따라 어떤 이미지 크기가 최적인지 정의합니다.

위와 같은 코드를 통해 어떤 이미지가 최적인지를 미리 정의하고 사용자에게 제공할 수 있습니다.

### 2-2. Image CDN
CDN 이란 콘텐츠를 효율적으로 제공하기 위해 분산되어 있는 서버를 의미합니다.
Image CDN은 이미지에 특화된 CDN을 의미합니다.
이미지 압축, 최적화 기능이 탑제되어 있습니다.
영상에서 실제 사례로 제시해주신 것은 마켓컬리 입니다.
마켓컬리는 이미지 요청시에는 jpg를 요청하지만 실제 응답을 받을 때는 webp이미지를 받고, 
이를 반환하는 서버는 cloudflare를 이용한 이미지 CDN 서버 입니다.

## 3. CLS(누적 레이아웃 변경) 개선하기
CLS란 사용자가 예상치 못한 레이아웃 이동을 경험하는 빈도를 수량화하고,
시각적 안정성을 나타내는 지표입니다.
여러 웹 시스템들을 이용하다 보면 이미지가 없었다가 갑자기 나타나면서 레이아웃이 변경되는 경험을 해보셨을 것 같습니다.
이런 현상을 지표로 나타내는 것은 CLS라고 할 수 있겠습니다.
이미지에 대한 이런 현상을 개선하기 위해서는 이미지에 크기에 대한 속성을 부여하는 것으로 간단히 개선할 수 있습니다.

```javascript
img {
  width: 600px;
  height: 340px;
}

img {
  width: 600px;
  aspect-ratio: 16/9;
}
```

## 4. 이미지 Lazy Loading
모든 이미지를 한 번에 로드 받는 것이 아니라 필요한 이미지만 필요한 순간에 다운로드 받는 것을 의미합니다.
만약 img의 `loading` 옵션을 지원하는 브라우저라면 속성 값을 `lazy`로 하는 것으로 간단히 처리할 수 있습니다.
하지만 그렇지 않은 경우엔 IntersectionObserver를 통해 검사하는 과정이 필요합니다.

## 5. 이미지 Pre Loading
이미지가 아주 클 경우 로드시에 시간이 많이 소요 됩니다.
따라서 이미지를 미리 로드 해놓고 사용하는 방식을 사용할 수 있습니다.
혹은 저해상도의 이미지를 먼저 보여주고 추가로 고해상도의 이미지로 교체하는 방식을 사용할 수도 있습니다.

---
## 참고
- [록바의 웹 성능 개선하기 - 이미지](https://www.youtube.com/watch?v=INPldifIEXE){: target="_blank"}


{% if page.comments %}
<div id="post-disqus" class="container">
{% include disqus.html %}
</div>
{% endif %}
